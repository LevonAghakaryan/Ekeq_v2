{% extends "base.html" %}

{% block content %}
<div class="bg-whiteCustom min-h-screen pt-[120px] pb-[80px] px-4">
    <div class="container mx-auto">
        <h2 class="text-center text-2xl md:text-3xl tracking-[5px] font-light text-headerDark uppercase mb-14 relative after:content-[''] after:absolute after:bottom-[-15px] after:left-1/2 after:-translate-x-1/2 after:w-[50px] after:h-[1px] after:bg-goldAccent">
            ‘∏’∂’ø÷Ä’•÷Ñ ‘ø’°’ø’•’£’∏÷Ä’´’°’∂
        </h2>

        <div class="flex justify-center gap-4 md:gap-8 flex-wrap mb-12 max-w-[1100px] mx-auto">
            {% for category in categories %}
            <a href="/catalog?category_id={{ category.id }}"
               class="flex flex-col items-center w-[80px] md:w-[100px] no-underline group">
                <div class="w-16 h-16 md:w-20 md:h-20 rounded-full overflow-hidden border transition-all duration-500 bg-white shadow-sm
                            {% if selected_category == category.id %} border-goldAccent -translate-y-1 shadow-md {% else %} border-goldAccent/20 group-hover:border-goldAccent group-hover:-translate-y-1 {% endif %}">
                    <img src="{{ category.image_url or '/static/images/default-cat.jpg' }}"
                         alt="{{ category.name }}"
                         class="w-full h-full object-cover transition-all duration-500
                                {% if selected_category == category.id %} grayscale-0 scale-110 {% else %} grayscale opacity-60 group-hover:grayscale-0 group-hover:opacity-100 group-hover:scale-110 {% endif %}">
                </div>
                <span class="text-[10px] uppercase tracking-widest mt-3 transition-all duration-300
                             {% if selected_category == category.id %} text-goldAccent font-medium text-[11px] {% else %} text-textGrey group-hover:text-goldAccent {% endif %}">
                    {{ category.name }}
                </span>
            </a>
            {% endfor %}
        </div>

        <hr class="border-0 h-[1px] bg-goldAccent opacity-20 w-3/5 mx-auto my-10">

        <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 md:gap-10">
            {% for template in templates %}
            <div class="bg-white rounded-[20px] p-2 border border-nudeBeige/40 transition-all duration-400 hover:-translate-y-2 hover:shadow-xl group">
                <a href="/invite/{{ template.demo_slug }}" class="block relative h-[160px] md:h-[400px] overflow-hidden rounded-[15px]">
                    <img src="{{ template.image_url }}" alt="{{ template.name }}"
                         class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110">
                    <div class="absolute inset-0 bg-black/20 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                        <span class="bg-[#7d936c] text-white px-4 py-2 rounded-full text-xs uppercase tracking-widest">‘¥’´’ø’•’¨</span>
                    </div>
                </a>

                <div class="p-3 md:p-5 text-center">
                    <h3 class="text-sm md:text-lg text-headerDark font-light mb-1 md:mb-2 min-h-[2.6em] md:min-h-0">{{ template.name }}</h3>
                    <p class="text-goldAccent font-bold text-sm md:text-base mb-3 md:mb-4">{{ template.price }} ÷è</p>

                    <div class="flex flex-col gap-2 md:gap-3">
                        <button onclick="openOrderModal('{{ template.id }}', '{{ template.name }}')"
                                class="border border-nudeBeige text-goldAccent py-2 rounded-full text-[10px] md:text-xs uppercase tracking-widest hover:bg-goldAccent hover:text-white transition-all">
                            ’ä’°’ø’æ’´÷Ä’•’¨
                        </button>
                        <a href="/invite/{{ template.demo_slug }}"
                           class="bg-[#445E3F] text-white py-2 rounded-full text-[10px] md:text-xs uppercase tracking-widest hover:bg-[#354a32] hover:shadow-lg transition-all">
                            ‘¥’´’ø’•’¨
                        </a>
                    </div>
                </div>
            </div>
            {% else %}
            <div class="col-span-full py-20 text-center">
                <p class="text-textGrey text-lg">‘±’µ’Ω ’¢’°’™’∂’∏÷Ç’¥ ’§’•’º÷á’Ω ’∂’¥’∏÷Ç’∑’∂’•÷Ä ’π’Ø’°’∂÷â üå∏</p>
            </div>
            {% endfor %}
        </div>
    </div>
</div>

<div id="orderModal" class="fixed inset-0 bg-headerDark/80 backdrop-blur-sm z-[2000] hidden flex items-center justify-center p-4 transition-all duration-300">
    <div class="bg-whiteCustom w-full max-w-[450px] rounded-[30px] md:rounded-[40px] p-6 md:p-10 shadow-2xl relative">
        <button onclick="closeOrderModal()" class="absolute top-5 right-5 text-textGrey hover:text-headerDark">
            <i class="fa-solid fa-xmark text-xl"></i>
        </button>

        <h3 class="text-xl md:text-2xl text-headerDark font-bold mb-1 text-center uppercase tracking-widest">’ä’°’ø’æ’´÷Ä’•’¨</h3>
        <p id="modal_template_name" class="text-goldAccent text-center text-xs md:text-sm mb-8 font-medium italic"></p>

        <form id="orderForm" class="space-y-4 md:space-y-5">
            <input type="hidden" name="template_id" id="form_template_id">

            <div class="space-y-1">
                <label class="text-[10px] uppercase tracking-[2px] ml-4 text-textGrey">’Å’•÷Ä ‘±’∂’∏÷Ç’∂’®</label>
                <input type="text" name="customer_name" required
                       class="w-full bg-bgLight border-none p-4 rounded-2xl focus:ring-2 focus:ring-goldAccent outline-none text-headerDark transition-all">
            </div>

            <div class="space-y-1">
                <label class="text-[10px] uppercase tracking-[2px] ml-4 text-textGrey">’Ä’•’º’°’≠’∏’Ω’°’∞’°’¥’°÷Ä</label>
                <input type="tel" name="phone_number" required
                       class="w-full bg-bgLight border-none p-4 rounded-2xl focus:ring-2 focus:ring-goldAccent outline-none text-headerDark transition-all"
                       placeholder="+374 __ __ __ __">
            </div>

            <div class="space-y-1">
                <label class="text-[10px] uppercase tracking-[2px] ml-4 text-textGrey">‘ø’°’∫’´ ’∂’°’≠’®’∂’ø÷Ä’•’¨’´ ’ø’°÷Ä’¢’•÷Ä’°’Ø</label>
                <select name="preferred_contact"
                        class="w-full bg-bgLight border-none p-4 rounded-2xl focus:ring-2 focus:ring-goldAccent outline-none text-headerDark appearance-none">
                    <option value="WhatsApp">WhatsApp</option>
                    <option value="Telegram">Telegram</option>
                    <option value="Call">‘∂’°’∂’£’°’∞’°÷Ä’•’¨</option>
                </select>
            </div>

            <div class="flex gap-4 pt-4">
                <button type="button" onclick="closeOrderModal()"
                        class="flex-1 py-4 text-textGrey uppercase tracking-widest text-[10px] font-bold">’â’•’≤’°÷Ä’Ø’•’¨</button>
                <button type="submit"
                        class="flex-1 bg-goldAccent text-white py-4 rounded-2xl uppercase tracking-widest text-[10px] font-bold hover:shadow-lg transition-all">
                    ’Ä’°’Ω’ø’°’ø’•’¨ ‚úÖ
                </button>
            </div>
        </form>
    </div>
</div>

<script>
    function openOrderModal(id, name) {
        document.getElementById('form_template_id').value = id;
        document.getElementById('modal_template_name').textContent = name;
        const modal = document.getElementById('orderModal');
        modal.classList.remove('hidden');
        modal.classList.add('flex');
        document.body.style.overflow = 'hidden'; // ‘ø’°’∂’≠’∏÷Ç’¥ ’ß ’ß’ª’´ scroll-’®
    }

    function closeOrderModal() {
        const modal = document.getElementById('orderModal');
        modal.classList.add('hidden');
        modal.classList.remove('flex');
        document.body.style.overflow = 'auto';
    }

    // Modal-’® ÷É’°’Ø’•’¨ ’§÷Ä’Ω’∏÷Ç’¥ ’Ω’•’≤’¥’•’¨’´’Ω
    window.onclick = function(event) {
        const modal = document.getElementById('orderModal');
        if (event.target == modal) {
            closeOrderModal();
        }
    }

    // ’ñ’∏÷Ä’¥’°’µ’´ ’∏÷Ç’≤’°÷Ä’Ø’∏÷Ç’¥’® AJAX-’∏’æ
    document.getElementById('orderForm').onsubmit = async (e) => {
        e.preventDefault();
        const formData = new FormData(e.target);

        try {
            const response = await fetch('/catalog/order', {
                method: 'POST',
                body: formData
            });

            const result = await response.json();

            if (response.ok) {
                alert('‚ú® ’á’∂’∏÷Ä’∞’°’Ø’°’¨’∏÷Ç’©’µ’∏÷Ç’∂÷â ’Å’•÷Ä ’∫’°’ø’æ’•÷Ä’∂ ’®’∂’§’∏÷Ç’∂’æ’°’Æ ’ß÷â ’Ñ’•’∂÷Ñ ’Ø’Ø’°’∫’∂’æ’•’∂÷Ñ ’Å’•’¶ ’∞’•’ø ’∑’°’ø ’∑’∏÷Ç’ø’∏’æ÷â');
                closeOrderModal();
                e.target.reset();
            } else {
                alert('‚ö†Ô∏è ’ç’≠’°’¨÷â ' + (result.message || '‘Ω’∂’§÷Ä’∏÷Ç’¥ ’•’∂÷Ñ ÷É’∏÷Ä’±’•’¨ ’∂’∏÷Ä’´÷Å÷â'));
            }
        } catch (error) {
            alert('‚ö†Ô∏è ‘ø’°’∫’´ ’Ω’≠’°’¨÷â ’ç’ø’∏÷Ç’£’•÷Ñ ’´’∂’ø’•÷Ä’∂’•’ø ’¥’´’°÷Å’∏÷Ç’¥’®÷â');
        }
    };
</script>

{% endblock %}