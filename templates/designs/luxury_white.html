<!DOCTYPE html>
<html lang="hy">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>{{ invitation.event_title }}</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body, html { height: 100%; background-color: #e0e0e0; font-family: 'Times New Roman', serif; overflow: hidden; display: flex; justify-content: center; align-items: center; }
        .animate-item { opacity: 0; transform: translateY(30px); transition: all 1s ease-out; }
        .animate-item.show { opacity: 1; transform: translateY(0); }
        .invitation-wrapper { position: relative; width: calc(100vw - 10px); height: calc(100vh - 10px); max-width: 480px; overflow: hidden; border-radius: 15px; box-shadow: 0 10px 40px rgba(0,0,0,0.2); }
        .base-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-image: url('https://i.pinimg.com/736x/80/f3/c0/80f3c09bdadd5bf96b927d3382ce6ccb.jpg'); background-size: cover; background-position: center; z-index: 1; }
        .scroll-container { position: absolute; top: 18%; bottom: 16%; left: 12%; right: 12%; z-index: 10; overflow-y: auto; scrollbar-width: none; mask-image: linear-gradient(to bottom, transparent, black 8%, black 92%, transparent); -webkit-mask-image: linear-gradient(to bottom, transparent, black 8%, black 92%, transparent); }
        .scroll-container::-webkit-scrollbar { display: none; }
        .content { padding: 30px 5px; text-align: center; color: #2c2c2c; }
        .names { font-size: clamp(1.3rem, 5.5vw, 1.7rem); letter-spacing: 4px; text-transform: uppercase; font-weight: 300; margin-bottom: 25px; }
        .photo-container { position: relative; width: 100%; max-width: 200px; aspect-ratio: 3 / 4; margin: 0 auto 30px auto; }
        .bg-paper { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-color: #ece4db; transform: rotate(4deg); z-index: 1; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        .main-img { position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; z-index: 2; filter: grayscale(100%); box-shadow: 0 8px 20px rgba(0,0,0,0.1); border: 3px solid #fff; }
        .invite-text { font-size: 0.95rem; line-height: 1.7; font-style: italic; margin-bottom: 30px; }
        .loc-item { display: flex; flex-direction: column; align-items: center; text-align: center; margin-bottom: 50px; position: relative; }
        .loc-circle-img { width: 90px; height: 90px; border-radius: 50%; border: 2px solid #fff; box-shadow: 0 10px 25px rgba(0,0,0,0.08); margin-bottom: 20px; object-fit: cover; background-color: #fff; }
        .loc-title { font-size: 1rem; font-weight: 400; letter-spacing: 5px; text-transform: uppercase; color: #1a1a1a; margin-bottom: 8px; max-width: 250px; margin-left: auto; margin-right: auto; line-height: 1.4; }
        .loc-address { font-size: 0.85rem; font-style: italic; color: #666; margin-bottom: 12px; }
        .map-btn { display: inline-block; font-size: 0.7rem; text-decoration: none; color: #1a1a1a; border: 1px solid #1a1a1a; padding: 10px 25px; margin-top: 10px; border-radius: 25px; transition: all 0.3s ease; min-width: 120px; }
        .map-btn:hover { background-color: #1a1a1a; color: #fff; }
        .calendar-box { margin: 40px auto; padding: 20px; max-width: 320px; }
        .month-title { font-size: 1.8rem; letter-spacing: 5px; text-transform: uppercase; margin-bottom: 20px; }
        .days-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 8px; margin-bottom: 30px; }
        .day-header { font-size: 0.65rem; color: #888; font-weight: bold; }
        .day-num { font-size: 0.9rem; padding: 10px 0; color: #444; }
        .selected-day { border: 1px solid #2c2c2c; border-radius: 50%; width: 35px; height: 35px; margin: 0 auto; display: flex; align-items: center; justify-content: center; }
        .waiting-text { font-size: 1.1rem; letter-spacing: 6px; text-transform: uppercase; margin-top: 20px; }
        .modal-content { padding: 40px 30px; width: 90%; max-width: 330px; margin: 0 auto; border: 1px solid rgba(0,0,0,0.1); box-shadow: 0 15px 50px rgba(0,0,0,0.1); }
        .rsvp-form { display: flex; flex-direction: column; gap: 25px; margin-top: 20px; }
        .rsvp-form input, .rsvp-form select, .rsvp-form textarea { border: none; border-bottom: 1px solid #ccc; padding: 10px 5px; background: transparent; outline: none; font-family: inherit; }
        .submit-btn { background: none; border: 1px solid #000; padding: 15px; text-transform: uppercase; letter-spacing: 3px; cursor: pointer; transition: 0.4s; }
        .submit-btn:hover { background: #000; color: #fff; }
        .submit-btn.success { background-color: #2ecc71 !important; color: white !important; border-color: #2ecc71 !important; cursor: default; }
        #timer { display: flex; justify-content: center; margin: 40px auto; max-width: 320px; }
        .timer-item { flex: 1; border-right: 1px solid rgba(0,0,0,0.1); }
        .timer-item:last-child { border-right: none; }
        .timer-num { font-size: clamp(1.2rem, 6vw, 1.8rem); display: block; }
        .timer-label { font-size: clamp(0.45rem, 2.5vw, 0.6rem); color: #999; }
        .spacer { height: 70px; }

        /* Success Modal Styles */
        #successModal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); backdrop-filter: blur(8px); z-index: 99999; display: none; align-items: center; justify-content: center; }
        #successModal.show { display: flex; }
        .inner-modal { background: #fff; width: 90%; max-width: 350px; padding: 40px 20px; border-radius: 20px; text-align: center; box-shadow: 0 20px 60px rgba(0,0,0,0.3); transform: scale(0.9); transition: 0.3s; }
        #successModal.show .inner-modal { transform: scale(1); }
    </style>
</head>
<body>

    <div class="invitation-wrapper">
        <div class="base-layer"></div>

        <div class="scroll-container" id="scrollContainer">
            <div class="content">

                <h1 class="names animate-item">
                    {{ invitation.content.couple_names.groom }} {{ invitation.content.couple_names.separator }} {{ invitation.content.couple_names.bride }}
                </h1>

                <div class="photo-container animate-item">
                    <div class="bg-paper"></div>
                    {% set main_photo = invitation.media_files | selectattr("label", "equalto", "main_hero") | first %}
                    <img src="{{ main_photo.file_url if main_photo else 'https://via.placeholder.com/400x600' }}" alt="Couple" class="main-img">
                </div>

                <p class="invite-text animate-item">
                    {{ invitation.content.welcome_text.description | replace('\n', '<br>') | safe }}
                </p>

                <section class="calendar-box animate-item">
                    <div class="month-title">
                        {% set months = ["’Ä’∏÷Ç’∂’æ’°÷Ä", "’ì’•’ø÷Ä’æ’°÷Ä", "’Ñ’°÷Ä’ø", "‘±’∫÷Ä’´’¨", "’Ñ’°’µ’´’Ω", "’Ä’∏÷Ç’∂’´’Ω", "’Ä’∏÷Ç’¨’´’Ω", "’ï’£’∏’Ω’ø’∏’Ω", "’ç’•’∫’ø’•’¥’¢’•÷Ä", "’Ä’∏’Ø’ø’•’¥’¢’•÷Ä", "’Ü’∏’µ’•’¥’¢’•÷Ä", "‘¥’•’Ø’ø’•’¥’¢’•÷Ä"] %}
                        {{ months[invitation.event_date.month - 1] }}
                    </div>
                    <div class="days-grid">
                        <div class="day-header">‘µ’ê‘ø</div><div class="day-header">‘µ’ê’î</div><div class="day-header">’â’ê’î</div><div class="day-header">’Ä’Ü‘≥</div><div class="day-header">’à’í’ê‘≤</div><div class="day-header">’á‘≤‘π</div><div class="day-header">‘ø‘ª’ê</div>
                        <div class="day-num" style="grid-column: {{ (invitation.event_date.weekday() + 1) }};">
                            <div class="selected-day">{{ invitation.event_date.day }}</div>
                        </div>
                    </div>
                    <div class="waiting-text">{{ invitation.content.welcome_text.title }}</div>
                </section>

                <div class="locations-oval">
                    {% for loc in invitation.content.locations %}
                    <div class="loc-item animate-item">
                        {% set loc_photo = invitation.media_files | selectattr("label", "equalto", loc.type) | first %}
                        <img src="{{ loc_photo.file_url if loc_photo else 'https://via.placeholder.com/100' }}" class="loc-circle-img" alt="{{ loc.type }}">
                        <p class="loc-title">{{ loc.title }}</p>
                        <p class="loc-address">{{ loc.address }}<br>‘∫’°’¥’®’ù {{ loc.time }}</p>
                        {% if loc.map_url %}
                        <a href="{{ loc.map_url }}" target="_blank" class="map-btn">’î’°÷Ä’ø’•’¶</a>
                        {% endif %}
                    </div>
                    {% endfor %}
                </div>

                <div class="modal-content animate-item">
                    <p style="font-style: italic; font-size: 0.9rem;">
                        ‘Ω’∂’§÷Ä’∏÷Ç’¥ ’•’∂÷Ñ ’∞’°’Ω’ø’°’ø’•’¨ ’∂’•÷Ä’Ø’°’µ’∏÷Ç’©’µ’∏÷Ç’∂’® ’¥’´’∂’π÷á {{ invitation.content.rsvp_settings.deadline }}
                    </p>
                    <form class="rsvp-form" id="rsvpForm">
                        <input type="text" id="guest_name" name="guest_name" placeholder="‘±’∂’∏÷Ç’∂ ‘±’¶’£’°’∂’∏÷Ç’∂" required>
                        <select id="attending" name="attending" required>
                            <option value="" disabled selected>‘ø’¥’°’Ω’∂’°’Ø÷Å’•’û÷Ñ</option>
                            <option value="yes">’ç’´÷Ä’∏’æ ’Ø’£’°’∂÷Ñ</option>
                            <option value="no">’ë’°’æ’∏÷Ñ ’π’•’∂÷Ñ ’Ø’°÷Ä’∏’≤</option>
                            <option value="maybe">‘¥’•’º ’π’•’¥ ’∏÷Ä’∏’∑’•’¨</option>
                        </select>
                        <input type="number" id="guest_count" name="guest_count" placeholder="’Ä’µ’∏÷Ç÷Ä’•÷Ä’´ ÷Ñ’°’∂’°’Ø" min="1" value="1" required>
                        <textarea id="message" placeholder="’Ä’°’≤’∏÷Ä’§’°’£÷Ä’∏÷Ç’©’µ’∏÷Ç’∂ (’Ø’°’¥’®’∂’ø÷Ä’°’Ø’°’∂)"></textarea>
                        <button type="submit" id="submitBtn" class="submit-btn">’Ä’°’Ω’ø’°’ø’•’¨</button>
                    </form>
                </div>

                <div id="timer" class="animate-item">
                    <div class="timer-item"><span class="timer-num" id="days">00</span><span class="timer-label">÷Ö÷Ä</span></div>
                    <div class="timer-item"><span class="timer-num" id="hours">00</span><span class="timer-label">’™’°’¥</span></div>
                    <div class="timer-item"><span class="timer-num" id="minutes">00</span><span class="timer-label">÷Ä’∏’∫’•</span></div>
                    <div class="timer-item"><span class="timer-num" id="seconds">00</span><span class="timer-label">’æ÷Ä’Ø</span></div>
                </div>

                <div class="spacer"></div>
            </div>
        </div>
    </div>

    <div id="successModal">
        <div class="inner-modal">
            <div style="font-size: 40px; margin-bottom: 15px;">ü•Ç</div>
            <h3 style="text-transform: uppercase; letter-spacing: 2px; margin-bottom: 10px;">’á’∂’∏÷Ä’∞’°’Ø’°’¨’∏÷Ç’©’µ’∏÷Ç’∂</h3>
            <p style="font-style: italic; color: #666; font-size: 0.9rem; line-height: 1.5;">’Å’•÷Ä ’∫’°’ø’°’Ω’≠’°’∂’® ’Ω’ø’°÷Å’æ’°’Æ ’ß: ’ç’´÷Ä’∏’æ ’Ω’∫’°’Ω’∏÷Ç’¥ ’•’∂÷Ñ ’Å’•’¶ ’¥’•÷Ä ’ø’∏’∂’´’∂:</p>
            <button onclick="closeModal()" style="margin-top: 25px; background: #000; color: #fff; border: none; padding: 10px 30px; cursor: pointer; text-transform: uppercase; font-size: 0.7rem; letter-spacing: 1px;">’ì’°’Ø’•’¨</button>
        </div>
    </div>

    <script>
        // ‘±’∂’´’¥’°÷Å’´’°
        const scrollContainer = document.getElementById('scrollContainer');
        const animateItems = document.querySelectorAll('.animate-item');
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => { if (entry.isIntersecting) entry.target.classList.add('show'); });
        }, { root: scrollContainer, threshold: 0.1 });
        animateItems.forEach(item => observer.observe(item));

        // ‘π’°’µ’¥’•÷Ä
        const targetDate = new Date("{{ invitation.event_date.strftime('%Y-%m-%dT%H:%M:%S') }}").getTime();
        function updateTimer() {
            const now = new Date().getTime();
            const diff = targetDate - now;
            if (diff > 0) {
                document.getElementById("days").innerText = Math.floor(diff / (1000 * 60 * 60 * 24)).toString().padStart(2, '0');
                document.getElementById("hours").innerText = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60)).toString().padStart(2, '0');
                document.getElementById("minutes").innerText = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60)).toString().padStart(2, '0');
                document.getElementById("seconds").innerText = Math.floor((diff % (1000 * 60)) / 1000).toString().padStart(2, '0');
            }
        }
        setInterval(updateTimer, 1000);
        updateTimer();

        // RSVP Submit
        document.getElementById('rsvpForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            const submitBtn = document.getElementById('submitBtn');
            const slug = "{{ invitation.slug }}";

            const formData = {
                guest_name: document.getElementById('guest_name').value,
                attending: document.getElementById('attending').value,
                guest_count: parseInt(document.getElementById('guest_count').value),
                message: document.getElementById('message').value
            };

            const originalText = submitBtn.innerText;
            submitBtn.innerText = "’à÷Ç’≤’°÷Ä’Ø’æ’∏÷Ç’¥ ’ß...";
            submitBtn.disabled = true;

            try {
                const response = await fetch(`/invite/${slug}/rsvp`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(formData)
                });

                if (response.ok) {
                    submitBtn.innerText = "‚úÖ ’Ä’°’Ω’ø’°’ø’æ’°’Æ ’ß";
                    submitBtn.classList.add('success');
                    document.getElementById('successModal').classList.add('show');
                    document.querySelectorAll('#rsvpForm input, #rsvpForm select, #rsvpForm textarea').forEach(el => el.disabled = true);
                } else {
                    alert('’ç’≠’°’¨ ’ø’•’≤’´ ’∏÷Ç’∂’•÷Å’°’æ:');
                    submitBtn.innerText = originalText;
                    submitBtn.disabled = false;
                }
            } catch (error) {
                alert('‘ø’°’∫’´ ’Ω’≠’°’¨:');
                submitBtn.innerText = originalText;
                submitBtn.disabled = false;
            }
        });

        function closeModal() {
            document.getElementById('successModal').classList.remove('show');
        }
    </script>
</body>
</html>